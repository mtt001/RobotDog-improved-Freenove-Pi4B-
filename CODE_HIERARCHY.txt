================================================================================
CODE HIERARCHY & STRUCTURE - mtDogMain.py
================================================================================

┌─────────────────────────────────────────────────────────────────────────────┐
│                           APPLICATION ENTRY POINT                           │
│                              mtDogMain.py                                   │
│                         (Main Entry: __main__)                              │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          CameraWindow (QWidget)                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  INHERITANCE:                                                         │ │
│  │    • QWidget (PyQt5)                                                  │ │
│  │    • DogLogicMixin (mtDogLogicMixin.py)                               │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  CORE COMPONENTS:                                                     │ │
│  │                                                                        │ │
│  │  • ball_tracker: BallTracker                                          │ │
│  │    └── head_tracker: HeadTracker (nested)                             │ │
│  │                                                                        │ │
│  │  • ball_mask_window: BallMaskWindow (optional)                         │ │
│  │                                                                        │ │
│  │  • dog_client: Client (Freenove library)                              │ │
│  │                                                                        │ │
│  │  • cap: cv2.VideoCapture (Mac camera)                                 │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  UI COMPONENTS:                                                        │ │
│  │                                                                        │ │
│  │  • video_label (QLabel) - Main video display                           │ │
│  │  • ctrl_panel (QFrame) - Right control panel                          │ │
│  │  • bottom_frame (QFrame) - Status bar                                  │ │
│  │  • Buttons: W/E/R/S/D/F/C, Beep, LED, Calib, Ball, Face, Play, Quit  │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  TIMERS:                                                               │ │
│  │    • timer (QTimer) → update_frame() [~33 fps]                        │ │
│  │    • telemetry_timer (QTimer) → poll_telemetry() [1 Hz]               │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  THREADS:                                                              │ │
│  │    • video_thread → dog_client.receiving_video()                       │ │
│  │    • cmd_thread → command_receiver_worker()                            │ │
│  │    • server_check_thread → server_check_worker()                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                    ┌─────────────────┴─────────────────┐
                    │                                   │
                    ▼                                   ▼
┌───────────────────────────────────┐  ┌───────────────────────────────────┐
│      mtDogBallTrack.py            │  │    mtDogLogicMixin.py              │
│                                   │  │                                    │
│  ┌─────────────────────────────┐  │  │  ┌─────────────────────────────┐  │
│  │   BallTracker               │  │  │  │   DogLogicMixin              │  │
│  │                             │  │  │  │                             │  │
│  │   • HSV thresholding        │  │  │  │   • ping_ip()               │  │
│  │   • Contour detection        │  │  │  │   • test_tcp_port()         │  │
│  │   • Temporal smoothing       │  │  │  │   • start_dog_client()      │  │
│  │   • Jump rejection           │  │  │  │   • shutdown_dog_client()   │  │
│  │   • Config I/O (JSON)       │  │  │  │   • poll_telemetry()         │  │
│  │   • head_tracker (nested)    │  │  │  │   • send_motion_command()   │  │
│  └─────────────────────────────┘  │  │  │   • handle_beep_key()        │  │
│                                    │  │  │   • handle_led_button()      │  │
│  ┌─────────────────────────────┐  │  │  │   • handle_calib_button()   │  │
│  │   HeadTracker                │  │  │  │   • handle_play_button()   │  │
│  │                             │  │  │  │   • check_low_voltage_beep() │  │
│  │   • P-controller             │  │  │  │   • command_receiver_worker() │  │
│  │   • Deadband                 │  │  │  │   • server_check_worker()   │  │
│  │   • Angle calculation        │  │  │  │                             │  │
│  └─────────────────────────────┘  │  │  └─────────────────────────────┘  │
│                                    │  │                                    │
│  ┌─────────────────────────────┐  │  │                                    │
│  │   BallMaskWindow (QWidget)  │  │  │                                    │
│  │                             │  │  │                                    │
│  │   • Mask visualization      │  │  │                                    │
│  │   • HSV sliders             │  │  │                                    │
│  │   • Rolling histograms      │  │  │                                    │
│  │   • Head Kp slider          │  │  │                                    │
│  │   • Mouse picker            │  │  │                                    │
│  └─────────────────────────────┘  │  │                                    │
│                                    │  │                                    │
│  ┌─────────────────────────────┐  │  │                                    │
│  │   HeadConfig (dataclass)    │  │  │                                    │
│  │                             │  │  │                                    │
│  │   • neutral_deg            │  │  │                                    │
│  │   • min_deg / max_deg      │  │  │                                    │
│  │   • kp (gain)              │  │  │                                    │
│  │   • deadband               │  │  │                                    │
│  └─────────────────────────────┘  │  │                                    │
└───────────────────────────────────┘  └───────────────────────────────────┘
                    │                                   │
                    └─────────────────┬─────────────────┘
                                      │
                    ┌─────────────────┴─────────────────┐
                    │                                   │
                    ▼                                   ▼
┌───────────────────────────────────┐  ┌───────────────────────────────────┐
│      mtDogConfig.py              │  │         Command.py                  │
│                                  │  │                                    │
│  • DOG_DEFAULT_IP                │  │  • COMMAND class                  │
│  • DOG_VIDEO_PORT                │  │    - CMD_MOVE_FORWARD             │
│  • DOG_CONTROL_PORT               │  │    - CMD_BUZZER                   │
│  • LOW_VOLTAGE_THRESHOLD          │  │    - CMD_HEAD                     │
│                                  │  │    - CMD_LED                      │
│                                  │  │    - etc.                         │
└───────────────────────────────────┘  └───────────────────────────────────┘
                    │
                    ▼
┌───────────────────────────────────┐
│         Client.py                 │
│    (Freenove Library)             │
│                                   │
│  • Client class                   │
│  • receiving_video()              │
│  • send_data()                    │
│  • image (numpy BGR)              │
│  • image_lock (threading.Lock)    │
└───────────────────────────────────┘

================================================================================
DATA FLOW DIAGRAM
================================================================================

┌──────────────┐
│  Dog Pi      │
│  (Camera)    │
└──────┬───────┘
       │ TCP Port 8001 (Video)
       ▼
┌─────────────────────┐
│  Client.receiving_  │
│  video() [Thread]    │
└──────┬──────────────┘
       │
       ▼
┌─────────────────────┐
│  Client.image       │
│  (BGR numpy array)   │
│  [Protected by lock]│
└──────┬──────────────┘
       │
       ▼
┌─────────────────────┐
│  update_frame()      │
│  [QTimer callback]   │
└──────┬──────────────┘
       │
       ├─────────────────┐
       │                 │
       ▼                 ▼
┌──────────────┐  ┌──────────────┐
│ BallTracker  │  │  Overlay     │
│ .process_    │  │  Drawing      │
│ with_mask()  │  │  (FPS, etc.)  │
└──────┬───────┘  └──────┬───────┘
       │                 │
       │                 │
       ▼                 │
┌──────────────┐         │
│ HeadTracker  │         │
│ .update_     │         │
│ from_ball()  │         │
└──────┬───────┘         │
       │                 │
       │                 │
       ▼                 │
┌──────────────┐         │
│ send_head_   │         │
│ angle()       │         │
└──────┬───────┘         │
       │                 │
       │                 │
       ▼                 │
┌──────────────┐         │
│ Dog Pi       │         │
│ (Servo)      │         │
└──────────────┘         │
                         │
                         ▼
                ┌──────────────┐
                │  QLabel      │
                │  (Display)   │
                └──────────────┘

================================================================================
COMMAND FLOW DIAGRAM
================================================================================

┌──────────────┐
│  User Input  │
│  (Key/Mouse) │
└──────┬───────┘
       │
       ▼
┌─────────────────────┐
│  Event Handler      │
│  (keyPressEvent,    │
│   button.clicked)   │
└──────┬──────────────┘
       │
       ├─────────────────┐
       │                 │
       ▼                 ▼
┌──────────────┐  ┌──────────────┐
│ DogLogicMixin│  │ CameraWindow │
│ Methods:     │  │ Methods:     │
│              │  │              │
│ • send_      │  │ • handle_    │
│   motion_    │  │   ball_      │
│   command()  │  │   button()   │
│              │  │              │
│ • handle_    │  │ • send_head_ │
│   beep_key() │  │   angle()    │
│              │  │              │
│ • handle_    │  │              │
│   led_       │  │              │
│   button()   │  │              │
└──────┬───────┘  └──────┬───────┘
       │                 │
       └────────┬────────┘
                │
                ▼
       ┌─────────────────┐
       │ dog_client       │
       │ .send_data()     │
       └────────┬─────────┘
                │
                ▼
       ┌─────────────────┐
       │  TCP Port 5001   │
       │  (Control)       │
       └────────┬─────────┘
                │
                ▼
       ┌─────────────────┐
       │  Dog Pi         │
       │  (Robot)        │
       └─────────────────┘

================================================================================
TELEMETRY FLOW DIAGRAM
================================================================================

┌─────────────────────┐
│ telemetry_timer     │
│ (1 Hz)             │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ poll_telemetry()    │
│                     │
│ • CMD_POWER         │
│ • CMD_SONIC         │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ dog_client          │
│ .send_data()        │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  TCP Port 5001      │
│  (Control)          │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  Dog Pi             │
│  (Response)         │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ command_receiver_   │
│ worker() [Thread]   │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ handle_cmd_line()   │
│                     │
│ Parse:              │
│ • "POWER#<voltage>"  │
│ • "SONIC#<distance>" │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ Update State:       │
│ • battery_v         │
│ • distance_cm        │
│ • telemetry_valid    │
└─────────────────────┘

================================================================================
END OF HIERARCHY DIAGRAM
================================================================================


