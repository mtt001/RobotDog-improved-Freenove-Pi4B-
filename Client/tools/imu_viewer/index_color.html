<!doctype html>
<!--
IMU Viewer Color Page
Description:
  Color model viewer with IMU telemetry, diagnostics, and model load status.
Version:
  2026.02.07-6
Revision History:
  2026-02-07 16:38 - Added WebRTC iframe layer for Live View (WebRTC-first fallback chain).
  2026-02-07 16:33 - Live View title now shows current stream resolution (e.g., Live View 800x600).
  2026-02-07 15:14 - Moved telemetry bar to top-left and added FPS text display.
  2026-02-07 14:46 - Replaced live-view placeholder with H264/MJPEG runtime elements.
  2026-02-07 13:39 - Added live telemetry polling for power/range.
-->
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>IMU Dog Viewer (Color)</title>
    <style>
      :root { color-scheme: light; --bg:#0e1116; --fg:#e6e6e6; --muted:#9aa3ad; --accent:#42b3ff; }
      html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font-family:"Avenir Next","Helvetica Neue",Arial,sans-serif}
      #hud{position:fixed;left:16px;top:54px;padding:10px 12px;background:rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.08);border-radius:8px;font-size:13px;line-height:1.4;z-index:10;min-width:240px}
      #hud .label{color:var(--muted)}
      #status{color:var(--accent);font-weight:600}
      canvas{display:block}
      #telemetry-bar{
        position:fixed;
        top:12px;
        left:16px;
        padding:6px 10px;
        background:rgba(0,0,0,.55);
        border:1px solid rgba(255,255,255,.08);
        border-radius:8px;
        font-size:13px;
        line-height:1.4;
        z-index:11;
      }
      #telemetryTop{white-space:nowrap}
      #three-container{
        position:fixed;
        left:16px;
        bottom:16px;
        width:48vw;
        height:48vh;
        min-width:360px;
        min-height:240px;
        border-radius:10px;
        overflow:hidden;
        border:1px solid rgba(255,255,255,.08);
        background:rgba(0,0,0,.25);
        z-index:1;
      }
      #live-view{
        position:fixed;
        left:50%;
        top:50%;
        transform:translate(-50%,-50%);
        width:40vw;
        height:40vh;
        min-width:360px;
        min-height:240px;
        border-radius:12px;
        border:1px solid rgba(255,255,255,.08);
        background:rgba(10,16,24,.55);
        display:flex;
        flex-direction:column;
        justify-content:flex-start;
        align-items:stretch;
        gap:6px;
        box-sizing:border-box;
        padding:10px;
        z-index:2;
        color:#cfd6df;
        text-align:center;
      }
      #live-view .title{font-weight:600; color:#ffffff}
      #live-media{
        flex:1;
        min-height:0;
        width:100%;
        height:100%;
        display:flex;
        align-items:center;
        justify-content:center;
      }
      #liveVideo,#liveMjpeg{
        width:100%;
        height:100%;
        object-fit:cover;
        border-radius:10px;
      }
      #liveWebrtc{
        width:100%;
        height:100%;
        border:0;
        border-radius:10px;
      }
      #liveStatus{
        position:absolute;
        left:12px;
        bottom:10px;
        font-size:12px;
        color:#d9e6f3;
        background:rgba(0,0,0,.45);
        border-radius:6px;
        padding:3px 6px;
      }
      #action-pane{
        position:fixed;
        right:16px;
        top:16px;
        padding:10px 12px;
        background:rgba(0,0,0,.55);
        border:1px solid rgba(255,255,255,.08);
        border-radius:10px;
        z-index:12;
        color:#cfd6df;
        min-width:210px;
      }
      #action-pane .title{color:#ffffff; font-weight:600; margin-bottom:6px}
      #action-pane .grid{display:grid; grid-template-columns:repeat(3, 1fr); gap:6px}
      #action-pane .row{display:flex; gap:6px; margin-top:6px}
      .action-btn{
        border:none;
        border-radius:8px;
        padding:6px 8px;
        font-size:12px;
        background:rgba(66,179,255,.2);
        color:#e6f2ff;
        cursor:pointer;
      }
      .action-btn:hover{background:rgba(66,179,255,.35)}
    </style>
  </head>
  <body>
    <div id="telemetry-bar">
      <span id="telemetryTop">Power --  Range --  0.0fps</span>
    </div>
    <div id="action-pane">
      <div class="title">Action Keys</div>
      <div class="grid">
        <button class="action-btn" data-cmd="CMD_TURN_LEFT">W<br>Turn L</button>
        <button class="action-btn" data-cmd="CMD_MOVE_FORWARD">E<br>Forward</button>
        <button class="action-btn" data-cmd="CMD_TURN_RIGHT">R<br>Turn R</button>
        <button class="action-btn" data-cmd="CMD_MOVE_LEFT">S<br>Left</button>
        <button class="action-btn" data-cmd="CMD_MOVE_STOP">Space<br>Stop</button>
        <button class="action-btn" data-cmd="CMD_MOVE_RIGHT">F<br>Right</button>
        <button class="action-btn" data-cmd="CMD_MOVE_BACKWARD">C<br>Backward</button>
        <button class="action-btn" data-cmd="CMD_RELAX">D<br>Relax</button>
        <button class="action-btn" data-cmd="CMD_BUZZER">B<br>Beep</button>
      </div>
      <div class="row">
        <button class="action-btn" data-cmd="CMD_LED">L LED</button>
        <button class="action-btn" data-cmd="CMD_CALIBRATION">K Calib</button>
        <button class="action-btn" data-cmd="CMD_WORKING_TIME">T Time</button>
      </div>
    </div>
    <div id="live-view">
      <div class="title" id="liveTitle">Live View</div>
      <div id="live-media">
        <iframe id="liveWebrtc" style="display:none" title="WebRTC Live View"></iframe>
        <video id="liveVideo" autoplay muted playsinline style="display:none"></video>
        <img id="liveMjpeg" alt="Live MJPEG stream" style="display:none" />
      </div>
      <div id="liveStatus">starting...</div>
    </div>
    <div id="three-container"></div>
    <div id="hud">
      <div><span class="label">Mode:</span> Color (pug)</div>
      <div><span class="label">Power:</span> <span id="power">--</span></div>
      <div><span class="label">Range:</span> <span id="range">--</span></div>
      <div><span class="label">Status:</span> <span id="status">starting</span></div>
      <div><span class="label">Diag:</span> <span id="diag">--</span></div>
      <div><span class="label">Error:</span> <span id="err">--</span></div>
      <div><span class="label">Proxy:</span> <span id="version">--</span></div>
      <div><span class="label">Proxy Time:</span> <span id="versiontime">--</span></div>
      <div><span class="label">Model:</span> <span id="modelstatus">loading</span></div>
      <div><span class="label">Model Err:</span> <span id="modelerr">--</span></div>
      <div><span class="label">Roll:</span> <span id="roll">--</span></div>
      <div><span class="label">Pitch:</span> <span id="pitch">--</span></div>
      <div><span class="label">Yaw:</span> <span id="yaw">--</span></div>
      <div><span class="label">Last OK:</span> <span id="lastok">--</span></div>
      <div style="margin-top:6px;"><a href="/" style="color:var(--accent); text-decoration:none;">Back</a></div>
    </div>
    <script type="module" src="/app_color.js"></script>
  </body>
</html>
